(function(win,doc){var QUEUE_NAME="_tfa",ACTION_PARAM_MAP={orderid:"orderid",currency:"currency",revenue:"revenue",quantity:"quantity",name:"name",attributionGroup:"attributionGroup"},MARK_PARAM_MAP={type:"marking-type"},LOG_URL_PREFIX=(win.location.protocol.match(/http/)?win.location.protocol:"http:")+"//trc.taboola.com/{$publishreId}log/3/{$logType}?",TFA_BASE_TEMPLATE=/(\S+)taboola(\S+|)\.com\/libtrc\/(\S+)\/tfa\.js(\S+|)/,actions=[],marks=[],protocol="http:";function dispatchMessage(msg){if(msg.notify==="action"){actions.push(msg);return}if(msg.notify==="mark"){marks.push(msg)}}function doActions(){var i,len,pubId=getPublisherId();if(!pubId){return}for(i=0,len=actions.length;i<len;i++){sendLog(supplant(LOG_URL_PREFIX,{$publishreId:pubId?pubId+"/":"",$logType:"action"})+"tim="+escape(getClientTimestamp())+"&item-url="+escape(getPageUrl())+getMapQueryString(ACTION_PARAM_MAP,actions.shift())+getStringParams())}}function doMarks(){var i,len,pubId=getPublisherId();if(!pubId){return}for(i=0,len=marks.length;i<len;i++){sendLog(supplant(LOG_URL_PREFIX,{$publishreId:pubId?pubId+"/":"",$logType:"mark"})+"tim="+escape(getClientTimestamp())+"&item-url="+escape(getPageUrl())+getMapQueryString(MARK_PARAM_MAP,marks.shift())+getStringParams())}}function supplant(str,data){return str.replace(/\{([^{}]*)\}/g,function(a,b){var r=data[b];return typeof r==="string"||typeof r==="number"?r:a})}function sendLog(src){var img=new Image;img.src=src}function getPageUrl(){return win.location.href}function getClientTimestamp(){var ts=new Date,hours=ts.getHours(),mins=ts.getMinutes(),secs=ts.getSeconds()+ts.getMilliseconds()/1e3;return(hours<10?"0":"")+hours+":"+(mins<10?"0":"")+mins+":"+(secs<10?"0":"")+secs.toFixed(3)}function getStringParams(){var urls=win.location.search,ref=doc.referrer.match(/(\?\S+)$/g),str="";str=getTrcParams(urls.replace(/^\?/,"").split(/&/))+(ref?getTrcParams(ref[0].replace(/^\?/,"").split(/&/)):"");return str}function getTrcParams(params){var str="",i,len,TRC_PARAM_PREFIX="trc_";for(i=0,len=params.length;i<len;i++){if(params[i].indexOf(TRC_PARAM_PREFIX)==0){str=str+"&"+params[i]}}return str}function getPublisherId(){var scripts=document.getElementsByTagName("script"),i,len,pubId="",src;for(i=0,len=scripts.length;i<len;i++){src=scripts[i].src;pubId=src.replace(TFA_BASE_TEMPLATE,"$3");if(scripts[i].src&&pubId!==scripts[i].src){return pubId}}return pubId}function getMapQueryString(paramMap,jsonObj){var i,query="";for(i in paramMap){if(jsonObj[i]!==undefined){query+="&"+paramMap[i]+"="+jsonObj[i]}}return query}function pushMessage(arg){for(var i=0;i<arguments.length;i++){arg=arguments[i];if(arg instanceof Object){dispatchMessage(arg)}}executeMessages();return arguments.length}function executeMessages(){doActions();doMarks()}function pullQueueMessages(){while(queue.length){pushMessage(queue.shift())}}function init(){queue=win[QUEUE_NAME]=win[QUEUE_NAME]||[];if(queue.registered){return}queue.push=pushMessage;queue.registered=true;pullQueueMessages()}if(win._trcIsUTactive){win.tfaObject={};tfaObject.dispatchMessage=dispatchMessage;tfaObject.pushMessage=pushMessage;tfaObject.getMapQueryString=getMapQueryString;tfaObject.getPublisherId=getPublisherId;tfaObject.getClientTimestamp=getClientTimestamp;tfaObject.doActions=doActions;tfaObject.dispatchMessage=dispatchMessage}else{init()}})(window,document);